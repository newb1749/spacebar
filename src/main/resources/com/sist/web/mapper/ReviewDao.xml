<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sist.web.dao.ReviewDao">
	
    <resultMap id="reviewResultMap" type="com.sist.web.model.Review">
		<id property="reviewSeq" column="REVIEW_SEQ" />
		<result property="rsvSeq" column="RSV_SEQ" />
		<result property="userId" column="USER_ID" />
		<result property="reviewTitle" column="REVIEW_TITLE" />
		<result property="reviewContent" column="REVIEW_CONTENT" />
		<result property="rating" column="RATING" />
		<result property="reviewStat" column="REVIEW_STAT" />
		<result property="regDt" column="REG_DT" />
		<result property="updateDt" column="UPDATE_DT" />
    </resultMap>
	
	<!-- 1. 리뷰 쓰기 전 예약 상태, 결제 상태 확인 -->
	<select id="findStatbyRsvSeq" resultType="com.sist.web.model.Reservation" parameterType="int">
	    SELECT 
	        RSV_STAT         AS rsvStat,        
	        RSV_PAYMENT_STAT AS rsvPaymentStat  
	    FROM 
	        reservation
	    WHERE 
	        RSV_SEQ = #{rsvSeq}
	</select>
	
	<!-- 2. 리뷰 등록 -->
	<insert id="insertReview" parameterType="com.sist.web.model.Review">
	  		<selectKey keyProperty="reviewSeq" resultType="int" order="BEFORE">
  			SELECT SEQ_REVIEW_SEQ.NEXTVAL FROM DUAL
  			</selectKey>
			 INSERT INTO review (
				    review_seq,
				    rsv_seq,
				    user_id,
				    review_title,
				    review_content,
				    rating,
				    review_stat,
				    reg_dt,
				    update_dt
				) VALUES ( #{reviewSeq},
				           #{rsvSeq},
				           #{userId},
				           #{reviewTitle},
				           #{reviewContent},
				           #{rating},
				           'Y',
				           SYSDATE,
				           SYSDATE)
	</insert>
	
	
</mapper>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sist.web.dao.RoomDao">
  
  <resultMap id="roomResultMap" type="com.sist.web.model.Room">
      <id column="ROOM_SEQ" property="roomSeq" />
      <result column="ROOM_CAT_SEQ" property="roomCatSeq" />
      <result column="HOST_ID" property="hostId" />
      <result column="ROOM_ADDR" property="roomAddr" />
      <result column="LATITUDE" property="latitude" />
      <result column="LONGITUDE" property="longitude" />
      <result column="REGION" property="region" />
      <result column="AUTO_CONFIRM_YN" property="autoConfirmYn" />
      <result column="ROOM_TITLE" property="roomTitle" />
      <result column="ROOM_DESC" property="roomDesc" />
      <result column="CANCEL_POLICY" property="cancelPolicy" />
      <result column="MIN_TIMES" property="minTimes" />
      <result column="MAX_TIMES" property="maxTimes" />
      <result column="AVERAGE_RATING" property="averageRating" />
      <result column="REVIEW_COUNT" property="reviewCount" />
      <result column="REG_DT" property="regDt" />
      <result column="UPDATE_DT" property="updateDt" />
  </resultMap>
  
  
  <insert id="insertRoom" parameterType="com.sist.web.model.Room">
  		<selectKey keyProperty="roomSeq" resultType="int" order="BEFORE">
  			SELECT SEQ_ROOM_SEQ.NEXTVAL FROM DUAL
  		</selectKey>
  		
	  		INSERT INTO ROOM (
			    ROOM_SEQ, ROOM_CAT_SEQ, HOST_ID, ROOM_ADDR,
			    LATITUDE, LONGITUDE, REGION, REG_DT, 
			    UPDATE_DT, AUTO_CONFIRM_YN, ROOM_TITLE, ROOM_DESC,
			    CANCEL_POLICY, MIN_TIMES, MAX_TIMES
			) VALUES (
			    #{roomSeq},
			    #{roomCatSeq}, 
			    #{hostId}, 
			    #{roomAddr},
			    #{latitude}, 
			    #{longitude}, 
			    #{region}, 
			    SYSDATE,
			    SYSDATE,
			    #{autoConfirmYn}, 
			    #{roomTitle}, 
			    #{roomDesc},
			    #{cancelPolicy}, 
			    #{minTimes}, 
			    #{maxTimes}
			)
  </insert>
  
	<select id="getRoomDetail" resultMap="roomResultMap" parameterType="int">
		SELECT 
			ROOM_SEQ, 
			ROOM_CAT_SEQ, 
			HOST_ID, 
			ROOM_ADDR, 
			LATITUDE, 
			LONGITUDE, 
			REGION, 
			AUTO_CONFIRM_YN, 
			ROOM_TITLE, 
			ROOM_DESC, 
			CANCEL_POLICY, 
			MIN_TIMES, 
			MAX_TIMES,
			AVERAGE_RATING,
			REVIEW_COUNT, 
			TO_CHAR(REG_DT, 'YY/MM/DD') AS REG_DT, 
			TO_CHAR(UPDATE_DT, 'YY/MM/DD') AS UPDATE_DT
		FROM ROOM
		WHERE ROOM_SEQ = #{roomSeq}
	</select>
  
	<select id="getRoomImagesByRoomSeq" parameterType="int" resultType="com.sist.web.model.RoomImage">
		SELECT 
			ROOM_IMG_SEQ, 
			ROOM_SEQ, 
			ROOM_IMG_ORIG_NAME, 
			ROOM_IMG_EXT, 
			IMG_SIZE, IMG_TYPE, 
			SORT_ORDER, ROOM_IMG_NAME
		FROM ROOM_IMAGE
		WHERE ROOM_SEQ = #{roomSeq}
		ORDER BY SORT_ORDER ASC
	</select>	
  
</mapper>
